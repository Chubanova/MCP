# Детали реализации MCP-сервера

## Реализация MCP-сервера

Файл: [`src/index.js`](../src/index.js):1-182

Сервер реализован с использованием @modelcontextprotocol/sdk и включает в себя:

1. Инициализацию MCP-сервера с именем и версией
2. Регистрацию трех инструментов:
   - `get_documentation` (строки 45-80)
   - `search_project` (строки 83-120)
   - `run_command` (строки 123-170)
3. Логирование вызовов инструментов (строки 12-22)
4. Подключение через stdio транспорт (строки 173-181)

## Реализация инструментов

### Инструмент get_documentation

Файл: [`src/index.js`](../src/index.js):45-80

Реализует поиск документации по запросу пользователя. В текущей реализации возвращает заглушку, но в реальном приложении здесь будет логика поиска по локальным источникам документации.

Логирование: строки 47-49, 59-61

Пример вывода:
```
[MCP] Вызов инструмента: get_documentation
[MCP] Параметры: {
  "query": "fs.readFile"
}
```

### Инструмент search_project

Файл: [`src/index.js`](../src/index.js):83-120

Реализует поиск по файлам проекта. В текущей реализации возвращает заглушку, но в реальном приложении здесь будет логика поиска по файлам проекта с ограничениями доступа.

Логирование: строки 85-87, 97-99

Пример вывода:
```
[MCP] Вызов инструмента: search_project
[MCP] Параметры: {
  "query": "calculateTotal"
}
```

### Инструмент run_command

Файл: [`src/index.js`](../src/index.js):123-170

Реализует выполнение безопасных команд с whitelisting. Проверяет, что команда находится в списке разрешенных команд из переменной окружения ALLOWED_COMMANDS.

Логирование: строки 125-127, 147-149, 159-161

Пример вывода:
```
[MCP] Вызов инструмента: run_command
[MCP] Параметры: {
  "command": "npm",
  "args": ["test"]
}
[MCP] Результат инструмента run_command: Успех
```

## Агент корректно вызывает нужный инструмент

Пример запроса, который должен вызвать инструмент `get_documentation`:

Запрос: "Покажи документацию для функции fs.readFile"

Ожидаемый инструмент: `get_documentation`

Фактическое подтверждение вызова:
```
[MCP] Вызов инструмента: get_documentation
[MCP] Параметры: {
  "query": "fs.readFile"
}
[MCP] Результат инструмента get_documentation: Успех
```

Хранится в: [`docs/testing-examples.md`](./testing-examples.md):3-23

## Требования к формату результатов инструментов

Контракт результатов инструментов описан в: [`docs/tool-contract.md`](./tool-contract.md):1-76